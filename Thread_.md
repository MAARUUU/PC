# Потоки в С#
Поток — это по сути последовательность инструкций, которые выполняются параллельно с другими потоками. Каждая программа создает по меньшей мере один поток: *основной*, который запускает функцию main(). Программа, использующая только главный поток, является *однопоточной*; если добавить один или более потоков, она станет *многопоточной*.  
Потоки — это способ сделать несколько вещей одновременно. Это может быть полезно, например, для отображения анимации и обработки пользовательского ввода данных во время загрузки изображений или звуков. Потоки также широко используется в сетевом программировании, во время ожидания получения данные будет продолжаться обновление и рисование приложения.   
Используя класс **Thread**, мы можем выделить в приложении несколько потоков, которые будут выполняться одновременно.  
Во-первых, для запуска нового потока нам надо определить задачу в приложении, которую будет выполнять данный поток. Для этого мы можем добавить новый метод, производящий какие-либо действия.  
Для создания нового потока используется делегат **ThreadStart**, который получает в качестве параметра выполняемый метод. И чтобы запустить поток, вызывается метод **Start**.
```c#
       // создаем новый поток
        Thread myThread = new Thread(new ThreadStart(Count));
        myThread.Start(); // запускаем поток
 ...................

      public static void Count()
       {
          for (int i = 1; i < 9; i++)
         {
            Console.WriteLine("Второй поток:");
            Console.WriteLine(i * i);
            Thread.Sleep(400);
         }
       }
```  
Здесь новый поток будет производить действия, определенные в методе Count. В данном случае это возведение в квадрат числа и вывод его на экран. И после каждого умножения с помощью метода **Thread.Sleep** мы усыпляем поток на 400 миллисекунд.  
## Потоки с параметрами
## Как передать данные в функцию потока
---
Для этой цели используется делегат **ParameterizedThreadStart**. Его действие похоже на функциональность делегата ThreadStart.  
Рассмотрим на примере:  
```c#
        int number = 4;
        // создаем новый поток
        Thread myThread = new Thread(new ParameterizedThreadStart(Count));
        myThread.Start(number); 
```  
После создания потока мы передаем метод myThread.Start(number); переменную, значение которой хотим передать в поток.   
Также существует **классовый подход,**он нужен нам, если нам надо передать не один, а несколько параметров различного типа. Сначала определяем специальный класс Counter, объект которого будет передаваться во второй поток, а в методе Main передаем его во второй поток.  
```c#
   class Program
  {
    static void Main(string[] args)
    {
        Counter counter = new Counter();
        counter.x = 4;
        counter.y = 5;
            
        Thread myThread = new Thread(new ParameterizedThreadStart(Count));
        myThread.Start(counter); 
 
        //...................
    }
 
    public static void Count(object obj)
    {
        for (int i = 1; i < 9; i++)
        {
            Counter c = (Counter)obj;
 
            Console.WriteLine("Второй поток:");
            Console.WriteLine(i*c.x *c.y);
        }
    }
 }
 
    public class Counter
    {
        public int x;
        public int y;
    }
```
## Как получить данные из функции потока?  
Значение, возвращаемое в функции, связанной с потоком thread, игнорируется, т.е. при имеющейся сигнатуре вернуть его в main не получится.  
Нужно либо передать его как **ссылочный аргумент ref с модификацией сигнатуры и последующим ожиданием завершения потока через join**, либо использовать **async**.
```c#
static void Main(string[] args)
{
     Thread myThread = new Thread();
     myThread.Start(Count,ref(er)); 
}
```  
Пример async в С++ :  
```c
auto fut = async(tr,a,b);
...
int result = fut.get();
```
## ThreadStart Delegate 
---
Вместо того, чтобы создавать подклассы класса Thread, мы просто создаем новый объект System.Threading.Thread и передаем ему делегат ThreadStart (это функция, в которой мы выполняем работу).  
```c#
class Runner
{
    void SomeMethod() 
    {
        Thread newThread = new Thread(new ThreadStart(Run));
        newThread.Start(); 
    }

     public void Run() 
     {
          Console.WriteLine("Running in a different thread.")
     }
}
```